{
  "name": "[LHM] DB ì´ë²¤íŠ¸ Flow",
  "nodes": [
    {
      "parameters": {
        "modelSource": "inferenceProfile",
        "model": "apac.anthropic.claude-sonnet-4-20250514-v1:0",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatAwsBedrock",
      "typeVersion": 1.1,
      "position": [
        896,
        208
      ],
      "id": "315942fe-8092-4487-8bc4-b9328f4c1479",
      "name": "AWS Bedrock Chat Model",
      "credentials": {
        "aws": {
          "id": "oBtvnNa9IuTXhBGc",
          "name": "[Testbed] AWS Account"
        }
      }
    },
    {
      "parameters": {
        "content": "## Task ê²€ì¦",
        "height": 352,
        "width": 496,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        832,
        0
      ],
      "id": "f2d4058e-09a8-475c-9bfe-35ee48fb204c",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.toJsonString() }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        1056,
        208
      ],
      "id": "c25a81a3-11c5-4774-8887-306c1828470e",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "endpointUrl": "https://workflow.work-portal.sktelecom.com/mcp/opmate_db_lhm",
        "serverTransport": "httpStreamable",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.1,
      "position": [
        1200,
        208
      ],
      "id": "b7f9a3aa-6c06-4521-853a-d2b9e085f06f",
      "name": "MCP Client"
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "function_name"
            },
            {
              "name": "param",
              "type": "object"
            }
          ]
        }
      },
      "id": "8daa8bc3-9370-4809-961b-31deae729238",
      "name": "When Executed by Another Workflow",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "position": [
        64,
        720
      ],
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "content": "## OPMATE MCP",
        "height": 352,
        "width": 652,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1376,
        0
      ],
      "id": "6b1aa723-4bca-45e7-ac3c-ec1f06289617",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "content": "## tools í˜¸ì¶œ ë¶€ë¶„",
        "height": 816,
        "width": 1328,
        "color": 5
      },
      "id": "18f77f41-943d-4ded-9bd8-086419ba4000",
      "name": "Sticky Note10",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        384
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "mode": "load",
        "qdrantCollection": {
          "__rl": true,
          "value": "OPMATE-TASK",
          "mode": "list",
          "cachedResultName": "OPMATE-TASK"
        },
        "prompt": "={{ $json.param.task_purpose }}",
        "topK": 5,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
      "typeVersion": 1.2,
      "position": [
        464,
        416
      ],
      "id": "015b3e1e-f076-4136-a4d9-a3951dcd8606",
      "name": "Qdrant Vector Store2",
      "credentials": {
        "qdrantApi": {
          "id": "BoUzaUcqPgVTfkRp",
          "name": "[EXSíŒ€][ìš´ì˜] QdrantApi account"
        }
      }
    },
    {
      "parameters": {
        "model": "amazon.titan-embed-text-v2:0"
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsAwsBedrock",
      "typeVersion": 1,
      "position": [
        464,
        560
      ],
      "id": "33b1947b-c314-47b6-8957-a39361f1cbf3",
      "name": "Embeddings AWS Bedrock",
      "credentials": {
        "aws": {
          "id": "oBtvnNa9IuTXhBGc",
          "name": "[Testbed] AWS Account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "abf2b2f8-b899-4edd-98b1-012c93b6ef17",
              "leftValue": "={{$json.node_list}}",
              "rightValue": 10,
              "operator": {
                "type": "array",
                "operation": "lengthLte",
                "rightType": "number"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        640,
        880
      ],
      "id": "61ec4417-a389-4392-bfc6-b61b92cc0e93",
      "name": "If"
    },
    {
      "parameters": {
        "url": "=https://api.work-portal.sktelecom.com/opmate2/target_list/{{ $json.param.task_id }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        480,
        704
      ],
      "id": "caf41346-c693-4298-a5ef-8fd5ac0af3fc",
      "name": "Target_list API1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "select service_nm,hostname,env,db_product_nm,db_operator1_nm,db_operator2_nm from v_opmate_v2_tag\nwhere db_yn='Y' and {{  $('When Executed by Another Workflow').item.json.param.query}}\nLimit 100",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        640,
        704
      ],
      "id": "248308c1-86ba-4cac-83f1-d7972b92ba44",
      "name": "Execute a SQL query2",
      "credentials": {
        "mySql": {
          "id": "t4CyQjCH0OZigxEz",
          "name": "[WorkPortal PRD] MySQL"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// DBì—ì„œ ì¡°íšŒí•œ ì „ì²´ ì¥ë¹„ ëª©ë¡\nconst dbResult = $input.all();\n\n// Target_list API ë…¸ë“œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°\nconst apiResult = $('Target_list API1').first().json;\n\n// OPMATE ëŒ€ìƒ hostname ë¦¬ìŠ¤íŠ¸\nconst targetList = apiResult.targetList;\n\n// 1. targetListê°€ ë¹„ì–´ìˆìœ¼ë©´\nif (!targetList || targetList.length === 0) {\n  return [\n    {\n      json: {\n        code: 'NO_TARGET',\n        msg: 'Taskì— ìˆ˜í–‰ ê°€ëŠ¥í•œ ì¥ë¹„ê°€ ì—†ìŠµë‹ˆë‹¤.',\n        data: [],\n      },\n    },\n  ];\n}\n\n// 2. dbResultê°€ ë¹„ì–´ìˆìœ¼ë©´\nif (!dbResult || dbResult.length === 0) {\n  return [\n    {\n      json: {\n        code: 'NO_HOST',\n        msg: 'ì „ë‹¬í•œ ì •ë³´ì— ë§ëŠ” í˜¸ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.',\n        data: [],\n      },\n    },\n  ];\n}\n\n// 3. í•„í„°ë§ëœ ì¥ë¹„ ë¦¬ìŠ¤íŠ¸ ìƒì„±\nconst filteredHosts = [];\nfor (let i = 0; i < dbResult.length; i++) {\n  const row = dbResult[i].json; // â† ì—¬ê¸°ì„œ .jsonìœ¼ë¡œ ì ‘ê·¼!\n  if (targetList.includes(row.hostname)) {\n    filteredHosts.push(row);\n  }\n}\n\nlet msg = '';\nlet data = [];\nlet code = '';\n\nif (filteredHosts.length > 0) {\n  msg = 'ì¥ë¹„ ì¡°íšŒ ì„±ê³µ';\n  data = filteredHosts;\n  code = 'OK';\n} else {\n  msg = 'Taskì— ìˆ˜í–‰ ê°€ëŠ¥í•œ í˜¸ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.';\n  data = targetList;\n  code = 'NO_MATCH';\n}\n\nreturn [\n  {\n    json: {\n      code: code,\n      msg: msg,\n      data: data,\n    },\n  },\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        816,
        704
      ],
      "id": "2e071147-2d9a-48e9-8f15-0a7b60884114",
      "name": "Code"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.work-portal.sktelecom.com/opmate2/task_run/{{ $json.task_nm }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": " application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "node_list",
              "value": "={{ $json.node_list }}"
            },
            {
              "name": "param_list",
              "value": "={{ $json.arguments || NULL }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "fullResponse": true
            }
          },
          "timeout": 300000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        832,
        864
      ],
      "id": "b381e189-e3cd-4efb-a3e4-3957b5f51612",
      "name": "OPMATE Task ìˆ˜í–‰"
    },
    {
      "parameters": {
        "jsCode": "// API ì‘ë‹µ ë°ì´í„°\nconst apiResult = $input.first().json.body;\n\n// resultMsg ì¶”ì¶œ\nconst resultMsg = apiResult.resultMsg;\n\n// runResultì—ì„œ í•„ìš”í•œ ê°’ë§Œ ì¶”ì¶œ\nconst runResult = apiResult.runResult.map(item => {\n  return {\n    hostname: item.hostname,\n    start_dt: item.start_dt,\n    stdout: item.stdout\n  };\n});\n\n// ìµœì¢… ê²°ê³¼ ë°˜í™˜\nreturn [\n  {\n    json: {\n      resultMsg,\n      runResult\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1040,
        864
      ],
      "id": "c1fc134a-df28-49f7-bcfd-c5510f0ca52c",
      "name": "Code3"
    },
    {
      "parameters": {
        "jsCode": "// n8n ì…ë ¥ ì•„ì´í…œ ì „ì²´ ê°€ì ¸ì˜¤ê¸°\nconst items = $input.all();\n\n// í•„ìš”í•œ í•„ë“œë§Œ ì¶”ì¶œ\nconst result = items.map(item => {\n  return {\n    content: item.json.document.pageContent,\n    task_id: item.json.document.metadata.task_id,\n    master: item.json.document.metadata.master,\n    score: item.json.score\n  };\n});\n\n// ìµœì¢… [{ data: [...] }] í˜•íƒœë¡œ ë°˜í™˜\nreturn [\n  {\n    json: {\n      data: result\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        816,
        416
      ],
      "id": "f00eb2c6-81cd-4c2e-8b38-3d252271d9fd",
      "name": "Code4"
    },
    {
      "parameters": {
        "name": "OPMATE_Task_Run",
        "description": "ëŒ€ìƒ í˜¸ìŠ¤íŠ¸ ëª©ë¡ê³¼ Task_idë¡œ OPMATE TASKë¥¼ ì¦‰ì‹œ ì‹¤í–‰í•©ë‹ˆë‹¤. (ì•½ 1~2ë¶„ ì •ë„ ì†Œìš”)",
        "workflowId": {
          "__rl": true,
          "value": "={{ $workflow.id }}",
          "mode": "id"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "function_name": "OPMATE_Task_Run",
            "param": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('param', `parameters:\n  type: object\n  properties:\n    task_id:\n      type: string\n      description: ì‹¤í–‰í•  OPMATE ì‘ì—…ëª…\n    hostname_list:\n      type: list\n      description: ì‘ì—…ì„ ì‹¤í–‰í•  ëŒ€ìƒ í˜¸ìŠ¤íŠ¸ëª… ëª©ë¡ìœ¼ë¡œ ì—¬ëŸ¬ëŒ€ ìˆ˜í–‰ì‹œ Listì— ë‹´ì•„ì„œ í•œë²ˆì— í˜¸ì¶œ(10ëŒ€ ì´ìƒ í˜¸ì¶œ ì œí•œ)\n    arguments:\n      type: string\n      description: |\n        (ì„ íƒ) ì‘ì—… ìŠ¤í¬ë¦½íŠ¸ì— ì „ë‹¬í•  ì¶”ê°€ ì¸ìê°’.\n        ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” ìœ„ì¹˜ ê¸°ë°˜ ë§¤ê°œë³€ìˆ˜(e.g. \\`$1\\`, \\`$2\\` ë“±)ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.\n  required:\n    - task_id\n    - hostname_list`, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "function_name",
              "displayName": "function_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "param",
              "displayName": "param",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.1,
      "position": [
        1840,
        208
      ],
      "id": "9769d46d-f984-46dd-9dff-6290a5a82e2a",
      "name": "OPMATE Task Run1"
    },
    {
      "parameters": {
        "name": "OPMATE_Task_Search",
        "description": "Vector DBì—ì„œ DBì™€ ê´€ë ¨ëœ OPMATE Taskë¥¼ ì°¾ìŠµë‹ˆë‹¤.\nì „ë‹¬ ë°›ì€ ì´ë²¤íŠ¸ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê°€ì¥ ìœ ì‚¬í•œ OPMATE Taskë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.",
        "workflowId": {
          "__rl": true,
          "value": "={{ $workflow.id }}",
          "mode": "id"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "function_name": "OPMATE_Task_Search",
            "param": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('param', `parameters:\n type: object\n properties:\n  task_purpose:\n    type: string\n    description: ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” ëª©ì (ìš©ë„)ì„ **í•œê¸€ë¡œ ì…ë ¥**í•©ë‹ˆë‹¤.\n required: [task_purpose]`, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "function_name",
              "displayName": "function_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "param",
              "displayName": "param",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.1,
      "position": [
        1472,
        208
      ],
      "id": "393923bb-f55f-41d2-9039-469fe4b7172f",
      "name": "OPMATE Task Search1",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "name": "OPMATE_Target_Search",
        "description": "ì´ë²¤íŠ¸ê°€ ë°œìƒí•œ host_name ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìœ ì‚¬ë„ê°€ ê°€ì¥ ë†’ì€ OPMATE TASKì˜ ëŒ€ìƒ ë…¸ë“œ ëª©ë¡ì—ì„œ ì°¾ìŠµë‹ˆë‹¤.\në§Œì•½ task_idì— ëŒ€í•œ ì •ë³´ê°€ ì—†ë‹¤ë©´ **OPMATE_Task_Search** ë¥¼ ì‚¬ìš©í•˜ì—¬ task_idë¥¼ í™•ì¸í•œ í›„ ì¡°íšŒí•©ë‹ˆë‹¤.\nì¶”ê°€ë¡œ í˜¸ìŠ¤íŠ¸ëª…ì„ ì‚¬ìš©ìê°€ ì „ë‹¬í•œë‹¤ë©´ ì´ê²Œ ëŒ€ìƒì´ ë§ëŠ”ì§€ ì •í™•í•œ í˜¸ìŠ¤íŠ¸ëª…ì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.\n\n**ë™ì‘ ë°©ì‹**  \n - ì‚¬ìš©ìê°€ ìì—°ì–´ë¡œ íŠ¹ì • ì¡°ê±´ì„ ìš”ì²­í•˜ë©´, í•´ë‹¹ ìš”ì²­ì„ SQL ì¡°ê±´ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì¡°íšŒë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.(mysql)\n - ê²€ìƒ‰ ì¡°ê±´ì€ ëª¨ë‘ `LIKE` ì—°ì‚°ìë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤.\n - ì£¼ìš” ê²€ìƒ‰ í•„ë“œ:  \n  - ì„œë¹„ìŠ¤ëª… â†’ `service_nm`  \n  - í˜¸ìŠ¤íŠ¸ëª… â†’ `hostname`\n  - í™˜ê²½ -> env\n  - ì œí’ˆëª… -> db_product_nm\n  - ìš´ì˜ì -> db_operator1_nm , db_operator2_nm\n - envëŠ” ìš´ì˜ - PRD / ê°œë°œ - DEV / ìŠ¤í…Œì´ì§• - STG / DR - DR / ê·¸ì™¸ëŠ” ETC\n\n**ì˜ˆì‹œ**  \n - ì‚¬ìš©ìê°€: \"gate ì„œë¹„ìŠ¤ ì¡°íšŒí•´ì¤˜\"  \n â†’ SQL ì¡°ê±´: `service_nm LIKE '%gate%'`\n - ì‚¬ìš©ìê°€: \"trpweb1 í˜¸ìŠ¤íŠ¸ëª… ê²€ìƒ‰í•´ì¤˜\"  \n â†’ SQL ì¡°ê±´: `hostname LIKE '%trpweb1%'`\n - ì‚¬ìš©ìê°€: \"oracle ìˆëŠ” ìš´ì˜ ì¥ë¹„ ì¤‘ì— ìš´ì˜ìê°€ ì‹¬í˜„ìŠ¹ì¸ ëŒ€ìƒ ë³´ì—¬ì¤˜\"  \n â†’ SQL ì¡°ê±´: `db_product_nm LIKE '%oracle%' AND env LIKE '%PRD%' AND 'ì‹¬í˜„ìŠ¹' in (db_operator1_nm,db_operator2_nm)`",
        "workflowId": {
          "__rl": true,
          "value": "={{ $workflow.id }}",
          "mode": "id"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "function_name": "OPMATE_Target_Search",
            "param": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('param', `parameters:\n  type: object\n  properties:\n    task_id:\n      type: string\n      description: ì¡°íšŒí•  OPMATE ì‘ì—…ëª…\n    query:\n      type: string\n      description: ì‚¬ìš©ìê°€ ìš”ì²­í•˜ëŠ” ê²€ìƒ‰ ì¡°ê±´ì„ ì¡°ê±´ ì¿¼ë¦¬ë¡œ íŒŒì‹±í•˜ì—¬ ì „ë‹¬(mysql)\n  required:\n    - task_id\n    - query`, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "function_name",
              "displayName": "function_name",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "param",
              "displayName": "param",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "object",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.1,
      "position": [
        1648,
        208
      ],
      "id": "1f381655-cb42-4163-936f-155939022c08",
      "name": "OPMATE_Target_Search1"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "ab18304c-4f73-430f-b9fa-2ce4d098e1fa",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "leftValue": "={{ $json.function_name }}",
                    "rightValue": "OPMATE_Task_Search"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "OPMATE_Task_Search"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "6df6a4b6-1edc-49b7-bdb5-3f5ce74dcb59",
                    "leftValue": "={{ $json.function_name }}",
                    "rightValue": "OPMATE_Target_Search",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "OPMATE_Target_Search"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "f96c987a-d0dd-4cd7-8344-c0118e256d65",
                    "leftValue": "={{ $json.function_name }}",
                    "rightValue": "OPMATE_Task_Run",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "OPMATE_Task_Run"
            }
          ]
        },
        "options": {}
      },
      "id": "a528ba5c-24df-40dc-986d-85baf1b73c1c",
      "name": "Switch1",
      "type": "n8n-nodes-base.switch",
      "position": [
        208,
        704
      ],
      "typeVersion": 3.2
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c3112290-4ae9-436f-aaa9-975214d950c4",
              "name": "task_nm",
              "value": "={{ $json.param.task_id }}",
              "type": "string"
            },
            {
              "id": "76ca287f-8c03-496b-a9e0-d48f0965f31c",
              "name": "node_list",
              "value": "={{ $json.param.hostname_list }}",
              "type": "array"
            },
            {
              "id": "dbc6c092-5941-4cca-bfd3-35a09f733b51",
              "name": "arguments",
              "value": "={{ $json.param.arguments }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        480,
        880
      ],
      "id": "524ea7ce-2723-435b-a731-370b4005cc22",
      "name": "ë³€ìˆ˜ ì •ë¦¬1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c2cf9d81-e79d-49df-a6c4-2631db92f9e8",
              "name": "msg",
              "value": "10ëŒ€ ì´ìƒ ìˆ˜í–‰í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
              "type": "string"
            },
            {
              "id": "2bcdd581-8370-47e4-8f1b-4593a5f2de7c",
              "name": "status",
              "value": "Fail",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        832,
        1040
      ],
      "id": "64293755-1496-40cb-9eec-9f4be1629add",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "path": "opmate_db_lhm"
      },
      "type": "@n8n/n8n-nodes-langchain.mcpTrigger",
      "typeVersion": 2,
      "position": [
        1568,
        48
      ],
      "id": "f602aead-f409-4b40-9ee0-c6f91ff6e415",
      "name": "MCP Server Trigger1",
      "webhookId": "7ed50d99-6a0e-4bae-b758-271b4a72f2fd"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "oracle_event_flow_lhm",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        64,
        192
      ],
      "id": "fd733268-fd7d-42aa-bac6-7350c9ea9b88",
      "name": "Webhook",
      "webhookId": "8921f3fb-3036-43a9-a8ab-0fca8a7acdc6"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9e7218ac-58f7-49ad-8abd-02eec1c430ff",
              "name": "host_name",
              "value": "={{ $json.body.host_name }}",
              "type": "string"
            },
            {
              "id": "36bc6c11-9774-475f-84da-93785b551f6f",
              "name": "splunk_domain",
              "value": "={{ $json.body.splunk_domain }}",
              "type": "string"
            },
            {
              "id": "4c4024e6-7bd9-491e-98c3-c5b165565f36",
              "name": "splunk_item",
              "value": "={{ $json.body.splunk_item }}",
              "type": "string"
            },
            {
              "id": "bb0eb429-c8d2-4510-b1d6-e7a3da43e3bf",
              "name": "issue_receive_date",
              "value": "={{ $json.body.issue_receive_date }}",
              "type": "string"
            },
            {
              "id": "9ff45aad-2990-48c3-963d-f2a452a3346c",
              "name": "msg",
              "value": "={{ $json.body.msg }}",
              "type": "string"
            },
            {
              "id": "91115a10-6395-4274-a0ab-31219b10b8dd",
              "name": "email",
              "value": "={{ $json.body.email }}",
              "type": "array"
            },
            {
              "id": "7b61ee9a-6288-42ba-ae28-6c941999fe3b",
              "name": "canvas_id",
              "value": "={{ $json.body.canvas_id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        272,
        192
      ],
      "id": "fb587ebc-a10c-4895-8edf-669b431baae2",
      "name": "Edit Fields3"
    },
    {
      "parameters": {
        "content": "## EVENT ìƒì„±ê¸° URL\n## Tower ë° ì´ë²¤íŠ¸ ì¶”ê°€ëŠ” ë°•ìˆ˜ë¯¼Mì—ê²Œ ìš”ì²­\n## https://workflow.work-portal.sktelecom.com/form/event_generater",
        "height": 352,
        "width": 792
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        0
      ],
      "id": "3af37f31-5a81-478e-a8ff-dda104414b04",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.toJsonString() }}",
        "options": {
          "systemMessage": "ë„ˆëŠ” DB Agentë¡œ msgì˜ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ MCPë¥¼ í™œìš©í•˜ì—¬ ì ì ˆí•œ OPMATE Taskë¥¼ ì°¾ê³ , host_nameì„ ì°¸ê³ í•˜ì—¬ Target ë…¸ë“œ ëŒ€ìƒìœ¼ë¡œ Taskë¥¼ ì‹¤í–‰í•´ì¤˜. ìµœì¢… ì ê²€ ê²°ê³¼ëŠ” Slackìœ¼ë¡œ ì „ë‹¬í•´ì¤˜.\n\nMUST : ì ‘ë‘ì‚¬ê°€ 'WP_MCP_DB_'ê°€ ì•„ë‹Œ TaskëŠ” ëŒ€ìƒì—ì„œ ì œì™¸í•´ì¤˜.\n\n",
          "maxIterations": 20
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        976,
        48
      ],
      "id": "9f23fe7f-9598-4b0d-9721-98b67f8f96fd",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "bd592539-15ff-4b86-ac2d-0036f4661a3e",
              "name": "type",
              "value": "text",
              "type": "string"
            },
            {
              "id": "9765e052-f0f1-4f10-8b27-0d6eccc68682",
              "name": "email",
              "value": "['hm_lee@sk.com']",
              "type": "array"
            },
            {
              "id": "2c0180d5-af3d-49e7-ae13-c3c2327034bb",
              "name": "mesg",
              "value": "={{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1440,
        480
      ],
      "id": "74cfd6d6-531a-4848-8ca2-b7942221f647",
      "name": "Slack ë³€ìˆ˜ ì„¤ì •"
    },
    {
      "parameters": {
        "content": "## Slack ì „ì†¡",
        "height": 460,
        "width": 652,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1376,
        384
      ],
      "id": "4250f170-9bf1-4568-ba1e-6f5aad08070e",
      "name": "Sticky Note12"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.work-portal.sktelecom.com/api/add_to_canvas",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "canvas_id",
              "value": "={{ $('Edit Fields3').item.json.canvas_id }}"
            },
            {
              "name": "content",
              "value": "=---\n## ğŸ¤– DB Agent ìˆ˜í–‰ê²°ê³¼\n```\n{{ $json.text }}\n```\n---"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1856,
        656
      ],
      "id": "c9d54523-4971-4082-8895-1a3501ef2846",
      "name": "Slack_Add_To_Canvas",
      "alwaysOutputData": false,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "import json\nimport re\n\n# ë‹¨ê³„ 1: ì…ë ¥ ë°ì´í„° ì²˜ë¦¬\ntry:\n    input_data = items[0]['json']\n    type_data = input_data['type']  # \"text\" ê·¸ëŒ€ë¡œ ìœ ì§€\n    emails = input_data['email']    # ì´ë©”ì¼ ëª©ë¡ ê·¸ëŒ€ë¡œ ìœ ì§€\n    mesg_str = input_data['mesg']   # mesg: JSON ë¬¸ìì—´ì´ ì•„ë‹Œ ì¼ë°˜ í…ìŠ¤íŠ¸\n    # mesg_strì„ ì¤„ ë‹¨ìœ„ë¡œ ë¶„í• \n    mesg = mesg_str.split('\\n')\nexcept KeyError as e:\n    return [{\"json\": {\"error\": f\"Missing key: {e}\"}}]\nexcept Exception as e:\n    return [{\"json\": {\"error\": f\"Error processing mesg: {e}\"}}]\n\n# ë””ë²„ê¹…: mesg êµ¬ì¡° í™•ì¸\nprint(f\"mesg length: {len(mesg)}\")\nprint(\"First few lines:\", mesg[:5])\n\n# ë‹¨ê³„ 2: Markdown â†’ Slack mrkdwn ë³€í™˜ (ëŒ€ì•ˆìš©)\nmrkdwn = '\\n'.join(mesg)\nmrkdwn = re.sub(r'\\*\\*(.*?)\\*\\*', r'*\\1*', mrkdwn)  # bold ë³€í™˜ (**text** â†’ *text*)\nmrkdwn = re.sub(r'^- ', 'â€¢ ', mrkdwn, flags=re.MULTILINE)  # bullet ë³€í™˜ (- â†’ â€¢)\nmrkdwn = re.sub(r'^###\\s*(.*?)$', r'*\\1*\\n', mrkdwn, flags=re.MULTILINE)  # í—¤ë”© ë³€í™˜\nmrkdwn = re.sub(r'---', 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€', mrkdwn, flags=re.MULTILINE)  # êµ¬ë¶„ì„  ë³€í™˜\n\n# ë‹¨ê³„ 3: Slack Blocks í¬ë§·íŒ… (ë™ì  ì„¹ì…˜ ë¶„ë¦¬)\nblocks = []\n\n# ì„¹ì…˜ë³„ë¡œ ë¶„ë¦¬í•˜ì—¬ ì²˜ë¦¬\nsections = [\n    (\"ğŸš¨ Server Down ì´ë²¤íŠ¸ ì´ìƒì¦ìƒ ë¶„ì„ ê²°ê³¼\", \"## ì´ë²¤íŠ¸ ì •ë³´\"),\n    (\"ğŸ” ì´ìƒì¦ìƒ ì§„ë‹¨ ê²°ê³¼\", \"## ì´ìƒì¦ìƒ íŒ¨í„´ ë¶„ì„\"),\n    (\"ğŸ› ï¸ ìë™ ì¡°ì¹˜ í•„ìš” ì—¬ë¶€ íŒë‹¨\", \"## ê¶Œì¥ ì¡°ì¹˜ ë°©ì•ˆ\"),\n    (\"âœ… ê²°ë¡ \", \"## ê²°ë¡ \")\n]\n\ncurrent_idx = 0\nfor section_title, section_start in sections:\n    # ì„¹ì…˜ ì‹œì‘ì  ì°¾ê¸°\n    start_idx = None\n    for i, line in enumerate(mesg[current_idx:], current_idx):\n        if line.strip().startswith(section_start):\n            start_idx = i\n            break\n    \n    if start_idx is None:\n        continue\n    \n    # ë‹¤ìŒ ì„¹ì…˜ ì‹œì‘ì  ì°¾ê¸°\n    end_idx = len(mesg)\n    for i, line in enumerate(mesg[start_idx + 1:], start_idx + 1):\n        if line.strip().startswith(\"## \"):\n            end_idx = i\n            break\n    \n    # ì„¹ì…˜ í…ìŠ¤íŠ¸ ì¶”ì¶œ\n    section_text = '\\n'.join(mesg[start_idx:end_idx])\n    section_text = re.sub(r'\\*\\*(.*?)\\*\\*', r'*\\1*', section_text)\n    section_text = re.sub(r'^- ', 'â€¢ ', section_text, flags=re.MULTILINE)\n    section_text = re.sub(r'---', 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€', section_text, flags=re.MULTILINE)\n    \n    # Blocks ì¶”ê°€\n    blocks.append({\n        \"type\": \"header\",\n        \"text\": {\"type\": \"plain_text\", \"text\": section_title, \"emoji\": True}\n    })\n    blocks.append({\n        \"type\": \"section\",\n        \"text\": {\n            \"type\": \"mrkdwn\",\n            \"text\": section_text if section_text.strip() else \"ë‚´ìš© ì—†ìŒ\"\n        }\n    })\n    blocks.append({\"type\": \"divider\"})\n    \n    current_idx = end_idx\n\n# ë²„íŠ¼ ì¶”ê°€\nblocks.append({\n    \"type\": \"actions\",\n    \"elements\": [\n        {\n            \"type\": \"button\",\n            \"text\": {\"type\": \"plain_text\", \"text\": \"ë¡œê·¸ í™•ì¸\", \"emoji\": True},\n            \"url\": \"https://aws.console/logs\"\n        }\n    ]\n})\n\n# ë””ë²„ê¹…: Blocks êµ¬ì¡° í™•ì¸\nprint(\"Blocks created:\", len(blocks))\n\n# ë‹¨ê³„ 4: ì¶œë ¥ (ì…ë ¥ ê·¸ëŒ€ë¡œ + Slackìš© blocks, text)\noutput = {\n    \"type\": type_data,\n    \"email\": emails,\n    \"mesg\": mesg_str,  # ì›ë³¸ í…ìŠ¤íŠ¸ ìœ ì§€\n    \"blocks\": blocks,  # Slack ë…¸ë“œì˜ Blocks í•„ë“œìš©\n    \"text\": mrkdwn     # ëŒ€ì•ˆ: Blocks ì‹¤íŒ¨ ì‹œ Text ì‚¬ìš©\n}\n\nreturn [{\"json\": output}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1648,
        480
      ],
      "id": "1a787e6e-9a09-4220-8629-426bba9306ce",
      "name": "Slack Formatter"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://workflow.work-portal.sktelecom.com/webhook/WPSlack",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "type",
              "value": "={{ $json[\"type\"] }}"
            },
            {
              "name": "email",
              "value": "={{ $json[\"email\"] }}"
            },
            {
              "name": "mesg",
              "value": "={{ $json[\"mesg\"] }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1856,
        480
      ],
      "id": "4650c519-17b5-4cba-9d53-181fdb753e55",
      "name": "WorkPortal Bot"
    }
  ],
  "pinData": {},
  "connections": {
    "AWS Bedrock Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Qdrant Vector Store2": {
      "main": [
        [
          {
            "node": "Code4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings AWS Bedrock": {
      "ai_embedding": [
        [
          {
            "node": "Qdrant Vector Store2",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "OPMATE Task ìˆ˜í–‰",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Target_list API1": {
      "main": [
        [
          {
            "node": "Execute a SQL query2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Execute a SQL query2": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OPMATE Task ìˆ˜í–‰": {
      "main": [
        [
          {
            "node": "Code3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OPMATE Task Run1": {
      "ai_tool": [
        [
          {
            "node": "MCP Server Trigger1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OPMATE Task Search1": {
      "ai_tool": [
        [
          {
            "node": "MCP Server Trigger1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OPMATE_Target_Search1": {
      "ai_tool": [
        [
          {
            "node": "MCP Server Trigger1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Qdrant Vector Store2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Target_list API1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ë³€ìˆ˜ ì •ë¦¬1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë³€ìˆ˜ ì •ë¦¬1": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Slack ë³€ìˆ˜ ì„¤ì •": {
      "main": [
        [
          {
            "node": "Slack Formatter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Slack ë³€ìˆ˜ ì„¤ì •",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Slack Formatter": {
      "main": [
        [
          {
            "node": "WorkPortal Bot",
            "type": "main",
            "index": 0
          },
          {
            "node": "Slack_Add_To_Canvas",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "",
  "meta": {
    "instanceId": "005da30201731d46df3296a3b817d911821f7e3be4d698136ad238440b479e5c"
  },
  "tags": []
}